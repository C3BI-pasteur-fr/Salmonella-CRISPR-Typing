<tool id="crispr" name="Salmonella Crispr" version="1.0.0">
  <description>identify known spacers and DRs for Salmonella.</description>
  <requirements>
    <requirement type="package" version="1.0.0">crispr</requirement>
  </requirements>
  <stdio>
    <exit_code range="1:" />
  </stdio>
  <edam_topics>
    <edam_topic>topic_0080</edam_topic>
    <edam_topic>topic_3301</edam_topic>
  </edam_topics>
  <edam_operations>
    <edam_operation>operation_2478</edam_operation>
    <edam_operation>operation_0239</edam_operation>
  </edam_operations>
  <command><![CDATA[
    crispr
      #if $choice_query.source == "history"
        $choice_query.query_seq
      #else
        $choice_query.typed_query
      #end if    
      -o salmonella-crispr.output
      $clean_sequences
      #if $settings.advanced == "advanced"
        $settings.truncate
        $settings.one_line_fasta
        $settings.list_spacers
        #if $settings.use_perso_spacers.use_perso_spacers
          -s $settings.use_perso_spacers.spacers
        #end if
      #end if
  ]]></command>
  <inputs>
    <!-- Query sequence(s) -->
    <conditional name="choice_query">
      <param name="source" type="select" label="Will you type your query sequence(s) or select it from your history?">
        <option value="history">Use query sequence(s) from the history</option>
        <option value="type">Type query sequence</option>
      </param>
      <when value="type">
        <param name="typed_query" type="text" label="Type your query sequence (FASTA format)" />
      </when>
      <when value="history">
        <param type="data" name="query_seq" format="fasta" label="Query sequence(s)" help="Can be full assembly or PCR product."/>
      </when>
    </conditional>
    <!-- Remove end characeter added (clean_sequences) -->
    <param argument="--clean_sequences" type="boolean" truevalue="--clean_sequences" falsevalue="" checked="true"/>
    <!-- Advanced parameters -->
    <conditional name="settings" >
      <param name="advanced" type="select" label="Advanced parameters">
          <option value="simple" selected="true">Hide</option>
          <option value="advanced">Show</option>
      </param>    
      <when value="simple" />
      <when value="advanced">
          <param argument="--truncate" type="boolean" checked="false" truevalue="--truncate" falsevalue="" label="Truncate output sequences" />
          <param argument="--one_line_fasta" type="boolean" checked="false" truevalue="--one_line_fasta" falsevalue="" label="Write ouput sequences in FASTA in one line." />
          <param argument="--list_spacers" type="boolean" checked="false" truevalue="--list_spacers" falsevalue="" label="List all found spacers in additional file." />
          <conditional name="use_perso_spacers">
              <param name="use_perso_spacers" type="boolean" checked="false" label="Use personnal spacers database" />
              <when value="false">
              </when>
              <when value="true">
                  <param argument="--spacers" type="data" format="fasta" label="Select your own spacers database from history" />
              </when>
          </conditional>
      </when>
    </conditional>
  </inputs>
  <outputs>
    <data format="fasta" name="results" from_work_dir="salmonella-crispr.output" label="Results from [$tool.name] on $[on_string]"/>
    <data format="bed" name="found_spacers" from_work_dir="found_spacers.bed" label="Spacers found with [$tool.name] on $[on_string]">
      <filter>settings['advanced'] == 'advanced' and settings['list_spacers']</filter>
    </data>
  </outputs>
  <tests>
    <!-- Test for basic and all files returned -->
    <test>

    </test>
  </tests>
  <help><![CDATA[

How does it work ?
==================

Help Page
==========

  ]]></help>
  <citations>
    <citation type="doi">10.1371/annotation/e79cea9a-6716-4519-9e96-31b17bf6a4fb</citation>
  </citations>
</tool>
